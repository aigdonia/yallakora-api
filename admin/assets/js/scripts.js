!function(){"use strict";function a(a){function b(a,b,c,d){}a.$on("$stateChangeStart",b),a.loadingUser=!1}angular.module("yallakora-admin",["ngSanitize","ui.router","ui.bootstrap","angular-ladda","angular-sweetalert","ui.select2","urlFilter","ngFileUpload"]).run(a),a.$inject=["$rootScope"]}(),function(){"use strict";function a(a,b,c){a.otherwise("/"),c.setOption({style:"slide-down"});var d="http://localhost:3002";b.interceptors.push(function(a){return{request:function(a){return 0===a.url.indexOf("/")&&(a.url=d+a.url),a}}})}angular.module("yallakora-admin").config(a),a.$inject=["$urlRouterProvider","$httpProvider","laddaProvider"]}(),function(){"use strict";function a(){return function(a){if(a<0)return"na";var b=_.round(a),c=b.toString();return _.floor(a/1e6)>0?c=_.floor(a/1e6).toString()+"M":_.floor(a/1e3)>0&&(c=_.floor(a/1e3).toString()+"K"),c}}angular.module("yallakora-admin").filter("shortyNumbers",a)}(),function(){"usr strict";angular.module("urlFilter",[]).filter("url",function(){return function(a){return _.startsWith(a,"htt")?"<a href='"+a+"' title='Stream URL'>"+a+"</a>":a}})}(),function(){"use strict";function a(a,b){var c=this;a.listAllChannels().then(function(a){c.channelsList=a}),c.createNewChannel=function(){a.createNewChannel(c.newChannelName).then(function(a){c.channelsList.push(a),c.newChannelName=""})},c.deleteChannel=function(d){b({title:"Delete Channel?",text:'Are you sure you want to delete "'+d.title+'"!',type:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#aaa",confirmButtonText:"Yes, delete it!"}).then(function(){a.deleteChannel(d.name).then(function(a){_.remove(c.channelsList,function(b){return a.name===b.name}),b({title:a.name+" Deleted",type:"success"})}).catch(function(a){b({title:"Failed",text:"Cant be Deleted",type:"error"})})})}}angular.module("yallakora-admin").controller("ChannelsController",a),a.$inject=["ChannelsService","swal"]}(),function(){"use strict";function a(a,b){return this.listAllChannels=function(){var c=a.defer();return b.get("/channels").then(function(a){c.resolve(a.data)}),c.promise},this.createNewChannel=function(c){console.log(c);var d=a.defer();return b.post("/channels",{name:c}).then(function(a){d.resolve(a.data.channel)},function(a){d.reject(a.data)}),d.promise},this.getChannelDetails=function(c){var d=a.defer();return b.get("/channels/"+c).then(function(a){d.resolve(a.data)}),d.promise},this.deleteChannel=function(c){var d=a.defer();return b.post("/channels/"+c+"/remove").then(function(a){d.resolve(a.data.channel)},function(a){d.reject(a)}),d.promise},this}angular.module("yallakora-admin").factory("ChannelsService",a),a.$inject=["$q","$http"]}(),function(){"use strict";function a(a){a.state("cast",{url:"/",templateUrl:"modules/cast/home.html",controller:"ChannelsController as ctrl"}).state("channel",{url:"channel/:channel_id",parent:"cast",templateUrl:"modules/cast/channel.html",controller:"SingleChannelController as ctrl"})}angular.module("yallakora-admin").config(a),a.$inject=["$stateProvider"]}(),function(){"use strict";function a(a,b){return this.getAllServers=function(){var c=a.defer();return b.get("/servers").then(function(a){c.resolve(a.data.servers)}),c.promise},this}angular.module("yallakora-admin").factory("StreamServers",a),a.$inject=["$q","$http"]}(),function(){"use strict";function a(a,b,c,d,e,f,g,h){var i=this;f.getChannelDetails(a.channel_id).then(function(a){i.channelDetails=a.data,i.channelStreams=_.sortBy(a.streams,["status"])}),i.newStreamWizard=function(){var a=c.open({animation:!1,ariaLabelledBy:"modal-title",ariaDescribedBy:"modal-body",templateUrl:"modules/cast/new-stream-modal.html",controller:"StreamModalController",controllerAs:"ctrl",resolve:{channel:function(){return i.channelDetails},qualities:function(){return h.getQualities().then(function(a){return a})},serversList:function(){return g.getAllServers().then(function(a){return a})}}});a.result.then(function(a){i.channelStreams.push(a)},function(){d.info("Modal dismissed at: "+new Date)})},i.activateStream=function(a){h.updateStream(a.id,{status:"active"}).then(function(c){a.status=c.status,b({title:"Stream Activate",text:"This stream is now available for public viewers",type:"success",timer:1e3})})},i.deactivateStream=function(a){b({title:"Deactivate Stream!",text:"Are you sure? This will hide it from public viewers",type:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Deactivate"}).then(function(){h.updateStream(a.id,{status:"idle"}).then(function(b){a.status=b.status})})},i.enableEdit=function(a){a.enableEdit=!0},i.updateStreamChannel=function(a){h.updateStream(a.id,{server_channel:a.server_channel}).then(function(c){a.server_channel=c.server_channel,b({title:"Stream Channel Changed",text:"Stream Channel is updated",type:"success",timer:1e3}),a.enableEdit=!1})},i.deleteStream=function(a){b({title:"Remove Stream!",text:"This will delete the stream and can't UNDO",type:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Delete"}).then(function(){h.deleteStream(a).then(function(a){_.remove(i.channelStreams,function(b){return b.id===a.id})})})},i.updateLogo=function(a){e.upload({url:"/channels/"+i.channelDetails.name+"/logo",data:{file:a}}).then(function(a){})},i.url=function(a){return _.replace(a.server.embded_pattern,"{CH}",a.server_channel).replace("{W}","500").replace("{H}","400")}}function b(a,b,c,d,e){var f=this;f.channelName=b.name,f.serversList=d,f.qualityList=c,f.newStream={},f.createStream=function(){e.createStream(b.id,f.newStream).then(function(b){a.close(b)})}}angular.module("yallakora-admin").controller("SingleChannelController",a).controller("StreamModalController",b),a.$inject=["$stateParams","swal","$uibModal","$log","Upload","ChannelsService","StreamServers","Stream"],b.$inject=["$uibModalInstance","channel","qualities","serversList","Stream"]}(),function(){"use strict";function a(a,b){return this.createStream=function(c,d){var e=b.defer(),f={title:d.title,quality:d.quality};return _.has(d,"stream_url")?f.url=d.stream_url:(f.server=d.server_id,f.channel=d.channel_id),a.post("/channels/"+c+"/stream",f).then(function(a){e.resolve(a.data.stream)}),e.promise},this.updateStream=function(c,d){var e=b.defer();return a.post("/streams/"+c,d).then(function(a){e.resolve(a.data)},function(a){e.reject(a)}),e.promise},this.getQualities=function(){var c=b.defer();return a.get("/lookups/quality").then(function(a){return console.log(a.data),c.resolve(a.data.quality)}),c.promise},this.deleteStream=function(c){var d=b.defer();return a.post("/streams/"+c.id+"/remove").then(function(a){d.resolve(a.data.stream)},function(a){d.reject(a)}),d.promise},this}angular.module("yallakora-admin").factory("Stream",a),a.$inject=["$http","$q"]}(),function(){"use strict";function a(){}angular.module("yallakora-admin").controller("StreamsController",a)}(),function(){"use strict";function a(a){a.state("users",{url:"/users",templateUrl:"modules/users/home.html"})}angular.module("yallakora-admin").config(a),a.$inject=["$stateProvider"]}(),function(){"use strict";function a(){var a=this;a.usersList=[{id:1,email:"aigdonia@gmail.com"},{id:2,email:"aigdonia@gmail.com"},{id:3,email:"aigdonia@gmail.com"},{id:4,email:"aigdonia@gmail.com"}]}angular.module("yallakora-admin").controller("UsersController",a),a.$inject=[]}(),angular.module("yallakora-admin").run(["$templateCache",function(a){"use strict";a.put("modules/cast/channel.html",'<div class="panel panel-default channel-title-panel"><div class="panel-body"><div ng-class="{&quot;hydrated&quot;:!!ctrl.channelDetails.logo}" ng-model="ctrl.logo" name="logo" ngf-pattern="\'image/png\'" ngf-accept="\'image/png\'" ngf-max-size="1MB" ngf-min-height="100" ngf-drag-over-class="\'dragover\'" ngf-resize="{height: 100}" ngf-select="ctrl.updateLogo($file)" ngf-drop="ctrl.updateLogo($file)" ngf-thumbnail="ctrl.logo || \'/thumb.jpg\'" ngf-as-background="true" class="uploader"><span ng-if="!(ctrl.channelDetails.logo || ctrl.logo)">Select Logo</span><img ng-if="!!ctrl.channelDetails.logo &amp;&amp; !ctrl.logo" ng-src="{{ctrl.channelDetails.logo}}"></div><h1 ng-bind="::ctrl.channelDetails.title"></h1></div></div><div ng-if="ctrl.channelStreams.length &lt;= 0" class="well well-lg"><p>No Streams Here Yet create one now!</p><button ng-click="ctrl.newStreamWizard()" class="btn btn-primary">Create Stream</button></div><div ng-if="ctrl.channelStreams.length &gt; 0" class="panel panel-default"><div class="panel-heading"><span>Streams</span><div class="pull-right"><div ng-click="ctrl.newStreamWizard()" class="btn btn-primary btn-sm"><i class="glyphicon glyphicon-plus"></i></div></div></div><table class="table table-condensed"><thead><tr><th></th><th>Title</th><th>Quality</th><th>Status</th><th>Server</th><th>Channel/URL</th><th></th></tr></thead><tbody><tr ng-repeat="stream in ctrl.channelStreams" ng-class="{\'warning\':(stream.status==\'idle\'), \'danger\':(stream.status==\'blocked\')}"><td></td><td>{{::stream.title}}</td><td>{{::stream.quality}}</td><td> <div ng-class="{\'label-success\':stream.status===\'active\',\'label-danger\':stream.status==\'blocked\'}" class="label label-default">{{stream.status}}</div></td><td ng-bind="stream.server.name || &quot;NA&quot;"></td><td><div ng-if="!!stream.server_channel"><form ng-submit="ctrl.updateStreamChannel(stream)"><div class="input-group"><input type="text" placeholder="Stream Channel" ng-model="stream.server_channel" ng-disabled="!stream.enableEdit" class="form-control"><span class="input-group-btn"><button type="button" ng-click="ctrl.enableEdit(stream)" ng-disabled="!!stream.enbleEdit" class="btn btn-default">Edit</button></span></div></form></div><span ng-if="!!stream.stream_url" ng-bind-html="stream.stream_url || &quot;NA&quot; | url"></span></td><td width="20%"><div class="btn-group"><a tooltip-placement="top" uib-tooltip="{{ctrl.url(stream)}}" href="{{ctrl.url(stream)}}" target="_blank" class="btn btn-sm btn-default"><i class="glyphicon glyphicon-eye-open"></i></a><a disabled title="Edit Stream Server" class="btn btn-sm btn-default"><i class="glyphicon glyphicon-edit"></i></a><a ng-click="ctrl.deleteStream(stream)" class="btn btn-sm btn-danger"><i class="glyphicon glyphicon-trash"></i></a></div><span> </span><div ng-hide="stream.status==&quot;blocked&quot;" class="btn-group"><a ng-if="stream.status==&quot;idle&quot;" ng-click="ctrl.activateStream(stream)" title="Make Public Channel" class="btn btn-sm btn-success"><i class="glyphicon glyphicon-play"></i></a><a ng-if="stream.status==&quot;active&quot;" ng-click="ctrl.deactivateStream(stream)" title="Make Private Channel" class="btn btn-sm btn-warning"><i class="glyphicon glyphicon-stop"></i></a></div></td></tr></tbody></table></div>'),a.put("modules/cast/channels.html",'<div ng-repeat="channel in ctrl.channelsList"><h3 ng-bind="::channel.name"></h3></div>'),a.put("modules/cast/home.html",'<div class="row"><div class="col-sm-3"><div class="panel panel-default"><div class="panel-heading">Channels</div><ul class="list-group"><li class="list-group-item"><form ng-submit="ctrl.createNewChannel()"><div class="input-group"><input type="text" placeholder="New Channel Name" ng-model="ctrl.newChannelName" class="form-control"><div class="input-group-btn"><button type="submit" class="btn btn-primary"><i class="glyphicon glyphicon-plus"></i></button></div></div></form></li><li ng-repeat="channel in ctrl.channelsList" ui-sref-active="channel-item--active" class="list-group-item channel-item"><a ui-sref="channel({channel_id:channel.name})" class="channel-item__name"><img ng-if="!!channel.logo" alt="ChannelLogo" ng-src="{{channel.logo}}"><span ng-bind="::channel.title"></span></a><a ng-click="ctrl.deleteChannel(channel)" class="channel-item__delete"><i class="glyphicon glyphicon-remove"></i></a></li></ul></div></div><div ui-view="" class="col-sm-9"></div></div>'),a.put("modules/cast/new-stream-modal.html",'<div class="modal-header"><h3 id="modal-title" class="modal-title">Add New Stream</h3></div><div id="modal-body" class="modal-body"><p>Add New Stream for channel \'{{ctrl.channelName}}\'</p><form><div class="form-group"><input placeholder="Stream Title (720p(HD), Low Quality-140p)" ng-model="ctrl.newStream.title" class="form-control input-lg"></div><div class="form-group"><div class="col-sm-12"><select ui-select2="{allowClear:true}" ng-model="ctrl.newStream.quality" placeholder="Select Server or search by server name" ng-required="true"><option ng-repeat="quality in ctrl.qualityList" value="{{quality.title}}">{{quality.title}}</option></select></div></div><div></div><div class="form-group"><uib-tabset active="active"><uib-tab index="0" heading="Configured Server"><div class="container-fluid"><div class="form-group"><input placeholder="Stream Channel ID" ng-model="ctrl.newStream.channel_id" class="form-control"></div><div class="form-group"><div class="col-sm-12"><select ui-select2="{allowClear:true}" ng-model="ctrl.newStream.server_id" data-placeholder="Select Server or search by server name" ng-required="true"><option ng-repeat="server in ctrl.serversList" value="{{server.id}}">{{server.name}}</option></select></div></div></div></uib-tab><uib-tab index="1" heading="Unkown Server"><div class="container-fluid"><input placeholder="Online Stream URL" ng-model="ctrl.newStream.stream_url" class="form-control"></div></uib-tab></uib-tabset></div></form></div><div class="modal-footer"><button type="button" ng-click="ctrl.createStream()" class="btn btn-primary">Add Stream</button></div>'),a.put("modules/users/home.html",'<div class="container-fluid"><div class="row"><div class="col-md-offset-2 col-md-8"><div class="panel panel-default"><div class="panel-heading"><span>Users</span><div class="pull-right"><button class="btn btn-primary btn-sm">New User</button></div></div><div class="panel-body"><table class="table"><thead><tr><th> </th><th>User Email</th><th></th></tr></thead><tbody><tr><td><input type="checkbox"></td><td>aigdonia@gmail.com</td><td><center><div class="btn-group"><a disabled title="Update Password" class="btn btn-sm btn-default"><i class="glyphicon glyphicon-lock"></i></a><a disabled class="btn btn-sm btn-danger"><i class="glyphicon glyphicon-trash"></i></a></div></center></td></tr></tbody></table></div></div></div></div></div>')}]);